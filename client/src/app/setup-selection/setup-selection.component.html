<div class="container mt-5">
  <h3>Set Up Your Dietary Preferences</h3>

  <form (ngSubmit)="submitDietaryPreferences()">
    <div class="mb-3">
      <label class="form-label">Diet Type</label>
      <select class="form-select" [(ngModel)]="selectedDietTypeId" name="dietType" required>
        <option [ngValue]="undefined" disabled>Select a diet type</option>
        @for(type of dietTypes; track type.name) {
          <option [ngValue]="type.id">{{ type.name }}</option>
        }
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Serving Type</label>
      <select class="form-select" [(ngModel)]="selectedServingTypeId" name="servingType" required>
        <option [ngValue]="undefined" disabled>Select a serving type</option>
        @for(serving of servingTypes; track serving.description) {
          <option [ngValue]="serving.id">
            {{ serving.description }} ({{ serving.numberOfServings }} servings)
          </option>
        }
      </select>
    </div>

    <hr />
    <h5>Select Allergies</h5>
    <div class="row">
      @if(allergyService.paginatedResult()?.items?.length) {
        @for(allergy of allergyService.paginatedResult()?.items; track allergy.name) {
          <div class="col-6 col-md-4 col-lg-3 mb-2">
            <div
              class="p-2 border rounded text-center"
              [class.bg-primary]="isSelected(allergy.id)"
              [class.text-white]="isSelected(allergy.id)"
              (click)="toggleAllergySelection(allergy.id)"
              style="cursor: pointer"
            >
              {{ allergy.name }}
            </div>
          </div>
        }

        <div class="d-flex justify-content-center mt-3">
          <pagination
            [totalItems]="allergyService.paginatedResult()?.pagination!.totalItems"
            [itemsPerPage]="allergyService.paginatedResult()?.pagination!.itemsPerPage"
            [(ngModel)]="allergyService.paginatedResult()?.pagination!.currentPage"
            (pageChanged)="onPageChanged($event)">
          </pagination>
        </div>
      } @else {
        <div class="col-12 text-center mt-4">
          <p class="text-muted">No allergies found.</p>
        </div>
      }
    </div>

    <button type="submit" class="btn btn-success mt-4" [disabled]="!selectedDietTypeId || !selectedServingTypeId">Save Preferences</button>
  </form>
</div>
